---
title: "Sepsis Survival Classification Naives Bayes"
author: "Rex Manglicmot"
date: "2022-12-18"
output: 
  github_document: 
    toc: yes
---
## Status: Continuing Working Document

Things still need to do/Questions:

* Concepts on Naive Bayes + Cite Sources
* color section for histogram
* think of new ideas to display plots


## Introduction
<center>
![](https://www.drugtargetreview.com/wp-content/uploads/sepsis-3.jpg)

</center>
**?????**
According to the Center for Disease Control and Prevention, in a given year, 1 of 3 patients who have died within the hospital had sepsis during hospitalization, however, nearly 87% of sepsis cases starts before the patient goes to the hospital.^[https://www.cdc.gov/sepsis/what-is-sepsis.html#:~:text=In%20a%20typical%20year%3A,had%20sepsis%20during%20that%20hospitalization] It leaves hospitals institutions in a precarious situation. How do ultimately help a patient get better and not be subjected to malpractice suits? 

The dataset contains 4 clinical features as follows:

* age(int): years: integer
* sex(binary): 0=male and 1=female
* episode_number (int): 
* hospital_outcome(boolean): 0=dead and 1=alive

## Loading the Libraries
```{r, message = FALSE}
#install.packages('hrbrthemes') #installed on 12/18/22
#install.packages('ggthemes') #installed on 12/18/22
#install.packages('ggdark') #installed on 12/8/22
#install.packages('colorspace') #installed on 12/8/22

library(tidyverse)
library(ggthemes)
library(ggplot2)
library(viridis)
library(colorspace)
library(scales)
library(naivebayes)
```

## Loading the Data
```{r}
#load the data
data_orig <- read.csv('Sepsis Survival.csv')

#view first 7 rows
head(data_orig, 7)
```

## Cleaning the Data
```{r}
#make a copy of the original dataset
data <- data_orig

#check for NA values
sum(is.na(data))

#change colnames
colnames(data) <- c('age', 'sex', 'epi', 'result')

#check for all values
uni <- lapply(data, unique)
uni

#check classes for all columns
unlist(lapply(data, class))

#change the sex, epi, and result columns 
data[,2:4] <- lapply(data[,2:4], as.factor)

#double check class but with a different function, sapply
sapply(data, class)
```
Let's explore

## Exploratory Data Analysis
```{r}
summary(data)
```

We see a few interesting insights from the summary function:

1. The mean is 62 and the median is 68 which means that Age as a symmetrical distribution.
2. Male and Females are almost the same, with slightly more males.
3. epi has more of the 1 category than the others. **Need to find more research about it and go back to the paper.**
4. More people with sepsis lived than died within the confines of the hospital. 

Let's visually check out the dataset. 
```{r, warning= FALSE, message=FALSE}
#create a histogram
ggplot(data, aes(x=age, fill= result)) +
  geom_histogram(alpha = .5, color = 'black') +
  facet_wrap(~result, scales= 'free_y') +
  scale_fill_discrete_qualitative() +
  theme_bw() +
  labs(title = 'Age Distribution by Those Who Died/Lived',
       subtitle = '0=Died and 1=Alive',
       y = 'Frequency',
       x = '')
```

We see two interesting insights:

1. Due to the facet wrap, we see that there are more people who lived than died.
2. Based on the Age distribution, we see that both populations were majority in the elderly age group and thus are right skewed. 

Let's see how they both compare.
```{r}
ggplot(data, aes(x=age, fill=result)) +
  geom_bar(position = 'dodge' ) +
  scale_fill_discrete_qualitative() +
  theme_bw()
```

Visually, we see that there is big difference in terms of size.

Let's check out their density. 
```{r}
#create a density plot
ggplot(data, aes(x=age, fill= sex)) +
  geom_density(alpha = .5, color = 'black') +
  scale_fill_discrete_qualitative() +
  theme_bw()
```


```{r}
#create a violin plot
ggplot(data, aes(x=epi, y=age, fill=sex)) +
  geom_violin(alpha = .5, color='black') +
  scale_fill_discrete_qualitative() +
  theme_bw()

ggplot(data, aes(x=epi, fill=result)) +
  geom_bar(alpha = .5, color='black', position = 'dodge', width=0.5,
           show.legend = TRUE) +
  facet_wrap(~ epi, scales = 'free') +
  scale_fill_discrete_qualitative() +
  theme_bw()
```


```{r}
#create a boxplot
ggplot(data, aes(x=result, y=age, fill=sex)) +
  geom_boxplot(alpha = .5, color = 'black') +
  scale_fill_discrete_qualitative() +
  theme_bw()

#create a barchart
ggplot(data, aes(x=result, fill=sex)) +
  geom_bar(alpha = .5, color='black', width = 0.5) +
  scale_fill_discrete_qualitative() +
  theme_bw()

#create a better  barchart
ggplot(data, aes(x=result, fill=sex)) +
  geom_bar(alpha = .5, color='black', width = 0.5) +
  facet_wrap(~ result, scales = 'free') +
  scale_fill_discrete_qualitative() +
  theme_bw()
```



## Naives Bayes
<center>
![](https://miro.medium.com/max/1154/1*lIhMVUIcX6cSq2URrG9M1w.webp)

</center>
Naive Bayes uses the Bayes theorem which states we can find the probability of A given B.^[https://towardsdatascience.com/naive-bayes-classifier-81d512f50a7c] 

<center>
![](https://miro.medium.com/max/750/1*tjcmj9cDQ-rHXAtxCu5bRQ.webp)

The assumption is A and B are independent. 
</center>

### Pros
### Cons

```{r}
#set seed to have reproducible results
set.seed(123)

#split data into a 70/30 split
ind <- sample(2, nrow(data), replace = T, prob = c(0.7, 0.3))

#split test and train
train <- data[ind==1, ]
test <- data[ind==2, ]

#build model
model <- naive_bayes(result~., data=train)
```


```{r}
#for numeric intergers we can get mean and sd for dead
train %>%
  dplyr::filter(result =='0') %>%
  summarise(mean(age), sd(age))

#for numeric intergers we can get mean and sd for alive
train %>%
  dplyr::filter(result =='1') %>%
  summarise(mean(age), sd(age))
```

```{r}
#plot the model
plot(model)
```


```{r}

```



## Limitations



## Conclusion



## Inspiration for this project